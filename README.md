# The Biergarten API v2

## About

This is a 'revamped' version of my [Biergarten App](https://github.com/aaronpo97/biergarten-app).

I am writing this app in an effort to continue learning about Typescript, Node, Express, and Postgres/TypeORM. The idea of writing a beer related app comes from my current job working in the retail operations of a brewery. It just so happens that I really enjoy beer as well!

I aim to rewrite the app using Postgres as my database rather than MongoDB as in the first version. The reasoning for this change was that the data I intend to store (e.g. brewery posts that have many beer posts) was less suited towards MongoDB and more towards a relational database.  This application uses Typescript with the Express framework in addition to TypeORM for the data service layer. It incorporates the Cloudinary API for image upload to the cloud, as well as the Sparkpost API for email services.

I am making this code public in the hopes that this content will be useful for anyone wanting to learn TypeORM, Typescript, or any other tools I use in this project.

I am currently developing a client side application for this API using React. The repository can be found [here](https://github.com/aaronpo97/biergarten-client).

### Some beer terminology

In this app you will encounter various beer related terms. Here is a list of terms used in this app and their definitions.

#### ABV

[Alcohol by volume](https://en.wikipedia.org/wiki/Alcohol_by_volume) (abbreviated as ABV) is a standard measure of how much alcohol (ethanol) is contained in a given volume of an alcoholic beverage (expressed as a volume percent).

#### IBU

The [International Bitterness Units](https://en.wikipedia.org/wiki/Beer_measurement#Bitterness) scale, or IBU, is used to approximately quantify the bitterness of beer. This scale is not measured on the perceived bitterness of the beer, but rather the amount of a component of beer known as iso-alpha acids.

## Database schema

!["Database schema"](/documentationAssets/biergarten_schema.drawio.svg "Database schema")

## How to run the development environment with a local database.

This section assumes that you have the current LTS version of Node.js (>=16.0). If that is not the case, first follow the instructions on the [Node.js website](https://nodejs.org/en/), then proceed with the instructions below.

All scripts are written in bash and assumes that you have a bash shell installed on your system.

### Step 1

To install all dependencies required by the app (both dev and production), run the following script in a terminal set to this directory.

```bash
npm install
```

### Step 2

#### Environment variables

In the same terminal, run the following script to define your development environment variables.

```bash
echo "
LOCAL_DB_CONNECTION_STRING=
CLOUD_DB_CONNECTION_STRING=

REFRESH_TOKEN_SECRET=
ACCESS_TOKEN_SECRET=
CONFIRMATION_TOKEN_SECRET=

CLOUDINARY_CLOUD_NAME=
CLOUDINARY_KEY=
CLOUDINARY_SECRET=

NODE_ENV=
PORT=
BASE_URL=

SPARKPOST_API_KEY=
" > .env
```

- This will create a `.env` file to hold your environment variables.

##### Additional steps

- Input the credentials to your database, as well as the port you wish to host the app on.
- Generate a refresh token secret, access token secret, and a confirmation token secret.
  - I suggest using a password generator set to 64 characters for these secrets for added security.

- [Create a Cloudinary account](https://cloudinary.com/users/register/free)
  - Cloudinary is a cloud-based image and video management service used for storing all media found in this application.
    - Once your account is created, navigate to the account dashboard and gather your required credentials. (CLOUDINARY_CLOUD_NAME, CLOUDINARY_KEY, CLOUDINARY_SECRET)

- [Create a Sparkpost account](https://app.sparkpost.com/join)
  - Sparkpost is an email sending platform used for sending emails for this application.
    - Once your account is created, navigate to the account dashboard and gather your required credentials.

##### Example

```env
LOCAL_DB_CONNECTION_STRING='postgres://{user}:{password}@{hostname}:{port}/{database-name}'
CLOUD_DB_CONNECTION_STRING='postgres://{user}:{password}@{hostname}:{port}/{database-name}'

REFRESH_TOKEN_SECRET='this_is_a_bad_secret'
ACCESS_TOKEN_SECRET='tHiS_1s_a_B3ttr_s3crt'
CONFIRMATION_TOKEN_SECRET='tHI$_!ss_3veN_bETter'

CLOUDINARY_CLOUD_NAME='your_cloud_name'
CLOUDINARY_KEY='your_clouidinary_key'
CLOUDINARY_SECRET='your_cloudinary_secret'

SPARKPOST_API_KEY='your_sparkpost_api_key'

NODE_ENV='dev'
PORT='8080'
BASE_URL='http://localhost'

```

### Step 3

### Seeding the database

All seed data is generated by the library [Faker.js](https://github.com/faker-js/faker#readme).

Run the following command in your terminal:

```bash
npm run seed
```

- This will reset the database by clearing each column. It will add your data to the database.

### Step 4

Run the following scripts, depending on the application mode you wish to use.

#### Developer mode

To run the application in `dev` mode:

```bash
npm run dev
```

#### Production mode

To run the application in `production` mode:

```bash
npm start
```

- This will create a directory called `./dist` which contains the compiled Typescript code.
